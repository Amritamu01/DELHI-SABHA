<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delhi Sabha - ‡§Ü‡§ß‡§ø‡§ï‡§æ‡§∞‡§ø‡§ï ‡§µ‡•á‡§¨‡§∏‡§æ‡§á‡§ü</title>
    
    <!-- Firebase SDK Version 10 -->
    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut,
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs,
            doc,
            setDoc,
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // üî• YOUR FIREBASE CONFIG (Updated)
        const firebaseConfig = {
            apiKey: "AIzaSyCBVXhX11_8___T1NzDPwGPXZxLYl8VuF4",
            authDomain: "politics-fd465.firebaseapp.com",
            databaseURL: "https://politics-fd465-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "politics-fd465",
            storageBucket: "politics-fd465.firebasestorage.app",
            messagingSenderId: "506429417906",
            appId: "1:506429417906:web:0196c57945e2d289895cab"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // DOM Elements
        let currentUser = null;

        // Page Elements
        const pages = {
            loginPage: document.getElementById('loginPage'),
            signupPage: document.getElementById('signupPage'),
            dashboardPage: document.getElementById('dashboardPage'),
            candidatePage: document.getElementById('candidatePage'),
            resultsPage: document.getElementById('resultsPage')
        };

        const userDisplay = document.getElementById('userDisplay');
        const loginError = document.getElementById('loginError');
        const signupError = document.getElementById('signupError');

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            // Check auth state
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    currentUser = user;
                    showDashboard();
                    userDisplay.textContent = user.email;
                } else {
                    showLogin();
                }
            });

            // Login Form
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    loginError.textContent = '';
                } catch (error) {
                    loginError.textContent = getErrorMessage(error.code);
                }
            });

            // Signup Form
            document.getElementById('signupForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const name = document.getElementById('signupName').value;
                
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    // Save user data to Firestore
                    await setDoc(doc(db, "users", userCredential.user.uid), {
                        name: name,
                        email: email,
                        createdAt: serverTimestamp(),
                        role: "voter"
                    });
                    signupError.textContent = '';
                } catch (error) {
                    signupError.textContent = getErrorMessage(error.code);
                }
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', () => {
                signOut(auth);
            });

            // Navigation
            document.getElementById('showSignup').addEventListener('click', showSignup);
            document.getElementById('showLogin').addEventListener('click', showLogin);
            document.getElementById('showCandidateForm').addEventListener('click', showCandidateForm);
            document.getElementById('showResults').addEventListener('click', showResults);
            document.getElementById('backToDashboard').addEventListener('click', showDashboard);
            document.getElementById('backToDashboardFromResults').addEventListener('click', showDashboard);

            // Candidate Form
            document.getElementById('candidateForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const party = document.getElementById('partyName').value;
                const agenda = document.getElementById('agenda').value;
                
                try {
                    await addDoc(collection(db, "candidates"), {
                        userId: currentUser.uid,
                        userName: currentUser.email,
                        party: party,
                        agenda: agenda,
                        votes: 0,
                        createdAt: serverTimestamp()
                    });
                    alert('‡§Ü‡§µ‡•á‡§¶‡§® ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡§Æ‡§æ ‡§π‡•ã ‡§ó‡§Ø‡§æ!');
                    showDashboard();
                } catch (error) {
                    console.error("Error adding candidate: ", error);
                }
            });
        });

        // Page Navigation Functions
        function showLogin() {
            hideAllPages();
            pages.loginPage.style.display = 'block';
        }

        function showSignup() {
            hideAllPages();
            pages.signupPage.style.display = 'block';
        }

        function showDashboard() {
            hideAllPages();
            pages.dashboardPage.style.display = 'block';
            loadCandidates();
        }

        function showCandidateForm() {
            hideAllPages();
            pages.candidatePage.style.display = 'block';
        }

        function showResults() {
            hideAllPages();
            pages.resultsPage.style.display = 'block';
            loadResults();
        }

        function hideAllPages() {
            Object.values(pages).forEach(page => {
                page.style.display = 'none';
            });
        }

        // Load Candidates
        async function loadCandidates() {
            const candidatesList = document.getElementById('candidatesList');
            candidatesList.innerHTML = '<p>‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>';
            
            try {
                const querySnapshot = await getDocs(collection(db, "candidates"));
                candidatesList.innerHTML = '';
                
                querySnapshot.forEach((doc) => {
                    const candidate = doc.data();
                    const div = document.createElement('div');
                    div.className = 'candidate-card';
                    div.innerHTML = `
                        <h4>${candidate.party}</h4>
                        <p>${candidate.agenda}</p>
                        <p>‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶‡§µ‡§æ‡§∞: ${candidate.userName}</p>
                        <button onclick="voteForCandidate('${doc.id}')">‡§µ‡•ã‡§ü ‡§¶‡•á‡§Ç</button>
                    `;
                    candidatesList.appendChild(div);
                });
            } catch (error) {
                console.error("Error loading candidates: ", error);
            }
        }

        // Load Results
        async function loadResults() {
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '<p>‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>';
            
            try {
                const querySnapshot = await getDocs(collection(db, "candidates"));
                resultsList.innerHTML = '';
                
                let candidates = [];
                querySnapshot.forEach((doc) => {
                    candidates.push({ id: doc.id, ...doc.data() });
                });
                
                // Sort by votes
                candidates.sort((a, b) => b.votes - a.votes);
                
                candidates.forEach((candidate, index) => {
                    const div = document.createElement('div');
                    div.className = 'result-card';
                    div.innerHTML = `
                        <h4>${index + 1}. ${candidate.party}</h4>
                        <p>‡§µ‡•ã‡§ü: ${candidate.votes || 0}</p>
                        <p>‡§è‡§ú‡•á‡§Ç‡§°‡§æ: ${candidate.agenda}</p>
                    `;
                    resultsList.appendChild(div);
                });
            } catch (error) {
                console.error("Error loading results: ", error);
            }
        }

        // Vote Function
        window.voteForCandidate = async function(candidateId) {
            if (!currentUser) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç');
                return;
            }
            
            try {
                // Add vote logic here
                alert('‡§µ‡•ã‡§ü ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!');
                loadCandidates();
            } catch (error) {
                console.error("Error voting: ", error);
            }
        }

        // Error Messages
        function getErrorMessage(errorCode) {
            const messages = {
                'auth/invalid-credential': '‡§ó‡§≤‡§§ ‡§à‡§Æ‡•á‡§≤ ‡§Ø‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°',
                'auth/user-not-found': '‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ',
                'auth/wrong-password': '‡§ó‡§≤‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°',
                'auth/email-already-in-use': '‡§à‡§Æ‡•á‡§≤ ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞‡•ç‡§° ‡§π‡•à',
                'auth/weak-password': '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§π‡•à (‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 6 ‡§Ö‡§ï‡•ç‡§∑‡§∞)',
                'auth/invalid-email': '‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡§æ'
            };
            return messages[errorCode] || '‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç';
        }
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a237e, #4a148c);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            margin: 50px auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .page {
            padding: 40px;
            display: none;
        }

        .page.active {
            display: block;
        }

        h1, h2, h3 {
            color: #1a237e;
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 30px;
            color: #4a148c;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4a148c;
        }

        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(to right, #4a148c, #1a237e);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 20, 140, 0.4);
        }

        .secondary-btn {
            background: #6c757d;
        }

        .link-btn {
            background: none;
            color: #4a148c;
            text-decoration: underline;
            padding: 0;
            margin: 10px 0;
        }

        .error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            text-align: center;
        }

        .success {
            color: #28a745;
            font-size: 14px;
            margin-top: 5px;
            text-align: center;
        }

        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .dashboard-options {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .option-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .option-card:hover {
            border-color: #4a148c;
            transform: translateY(-3px);
        }

        .candidate-card, .result-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #4a148c;
        }

        @media (max-width: 600px) {
            .container {
                margin: 20px auto;
                border-radius: 10px;
            }
            
            .page {
                padding: 25px;
            }
            
            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="container">
        <div id="loginPage" class="page">
            <h1>‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§∏‡§≠‡§æ ‡§Æ‡•á‡§Ç ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</h1>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡§æ</label>
                    <input type="email" id="loginEmail" required placeholder="example@email.com">
                </div>
                <div class="form-group">
                    <label for="loginPassword">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                    <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div id="loginError" class="error"></div>
                <button type="submit">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
            </form>
            <button id="showSignup" class="link-btn">‡§®‡§Ø‡§æ ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç</button>
        </div>

        <!-- Signup Page -->
        <div id="signupPage" class="page" style="display:none;">
            <h1>‡§®‡§Ø‡§æ ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç</h1>
            <form id="signupForm">
                <div class="form-group">
                    <label for="signupName">‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ</label>
                    <input type="text" id="signupName" required placeholder="‡§Ü‡§™‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ">
                </div>
                <div class="form-group">
                    <label for="signupEmail">‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡§æ</label>
                    <input type="email" id="signupEmail" required placeholder="example@email.com">
                </div>
                <div class="form-group">
                    <label for="signupPassword">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                    <input type="password" id="signupPassword" required placeholder="‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 6 ‡§Ö‡§ï‡•ç‡§∑‡§∞">
                </div>
                <div id="signupError" class="error"></div>
                <button type="submit">‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§¨‡§®‡§æ‡§è‡§Ç</button>
            </form>
            <button id="showLogin" class="link-btn">‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§π‡•à? ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button>
        </div>

        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page" style="display:none;">
            <div class="user-info">
                <h3>‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à!</h3>
                <p id="userDisplay">‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
            </div>
            <h2>‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</h2>
            <div class="dashboard-options">
                <div class="option-card" id="showCandidateForm">
                    <h3>‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶‡§µ‡§æ‡§∞ ‡§¨‡§®‡•á‡§Ç</h3>
                    <p>‡§ö‡•Å‡§®‡§æ‡§µ ‡§Æ‡•á‡§Ç ‡§≠‡§æ‡§ó ‡§≤‡•á‡§Ç</p>
                </div>
                <div class="option-card" id="showResults">
                    <h3>‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§¶‡•á‡§ñ‡•á‡§Ç</h3>
                    <p>‡§µ‡•ã‡§ü‡§ø‡§Ç‡§ó ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ</p>
                </div>
                <div id="candidatesList" class="dashboard-options">
                    <!-- Candidates will be loaded here -->
                </div>
            </div>
            <button id="logoutBtn" class="secondary-btn">‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
        </div>

        <!-- Candidate Application Page -->
        <div id="candidatePage" class="page" style="display:none;">
            <h1>‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶‡§µ‡§æ‡§∞ ‡§Ü‡§µ‡•á‡§¶‡§®</h1>
            <form id="candidateForm">
                <div class="form-group">
                    <label for="partyName">‡§™‡§æ‡§∞‡•ç‡§ü‡•Ä/‡§∏‡§Æ‡•Ç‡§π ‡§ï‡§æ ‡§®‡§æ‡§Æ</label>
                    <input type="text" id="partyName" required placeholder="‡§Ü‡§™‡§ï‡•Ä ‡§™‡§æ‡§∞‡•ç‡§ü‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ">
                </div>
                <div class="form-group">
                    <label for="agenda">‡§Ü‡§™‡§ï‡§æ ‡§è‡§ú‡•á‡§Ç‡§°‡§æ/‡§µ‡§æ‡§¶‡•á</label>
                    <textarea id="agenda" rows="4" required placeholder="‡§Ü‡§™‡§ï‡§æ ‡§ö‡•Å‡§®‡§æ‡§µ‡•Ä ‡§è‡§ú‡•á‡§Ç‡§°‡§æ..."></textarea>
                </div>
                <button type="submit">‡§Ü‡§µ‡•á‡§¶‡§® ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡•á‡§Ç</button>
            </form>
            <button id="backToDashboard" class="link-btn">‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç</button>
        </div>

        <!-- Results Page -->
        <div id="resultsPage" class="page" style="display:none;">
            <h1>‡§ö‡•Å‡§®‡§æ‡§µ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ</h1>
            <div id="resultsList">
                <!-- Results will be loaded here -->
            </div>
            <button id="backToDashboardFromResults" class="secondary-btn">‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç</button>
        </div>
    </div>

    <script>
        // Additional initialization
        document.addEventListener('DOMContentLoaded', function() {
            // Already handled in Firebase module
        });
    </script>
</body>
</html>
