<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DELHI SIM - Digital Democracy</title>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut,
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs,
            getDoc,
            doc,
            setDoc,
            updateDoc,
            query,
            where,
            orderBy,
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCBVXhX11_8___T1NzDPwGPXZxLYl8VuF4",
            authDomain: "politics-fd465.firebaseapp.com",
            databaseURL: "https://politics-fd465-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "politics-fd465",
            storageBucket: "politics-fd465.firebasestorage.app",
            messagingSenderId: "506429417906",
            appId: "1:506429417906:web:0196c57945e2d289895cab"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global Variables
        let currentUser = null;
        let userData = null;
        let theme = 'light';
        let electionEndDate = new Date();
        electionEndDate.setDate(electionEndDate.getDate() + 30);

        // Initialize App
        document.addEventListener('DOMContentLoaded', async function() {
            // Check saved theme
            const savedTheme = localStorage.getItem('delhiSimTheme');
            if (savedTheme) {
                theme = savedTheme;
                setTheme(theme);
            }
            
            // Initialize election timer
            initializeElectionTimer();
            
            // Show India Gate animation after 3 seconds on home page
            setTimeout(() => {
                if (document.getElementById('dashboardPage').classList.contains('active')) {
                    showIndiaGateAnimation();
                }
            }, 3000);
            
            // Auth state listener
            onAuthStateChanged(auth, async (user) => {
                currentUser = user;
                if (user) {
                    await loadUserData(user.uid);
                    showAnimation();
                    setTimeout(() => {
                        hideAnimation();
                        showDashboard();
                    }, 3000);
                } else {
                    showLogin();
                }
            });

            setupEventListeners();
        });

        // India Gate Animation
        function showIndiaGateAnimation() {
            const indiaGate = document.getElementById('indiaGateAnimation');
            indiaGate.style.display = 'flex';
            setTimeout(() => {
                indiaGate.style.opacity = '1';
                indiaGate.style.transform = 'translateY(0)';
            }, 100);
            
            setTimeout(() => {
                indiaGate.style.opacity = '0';
                indiaGate.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    indiaGate.style.display = 'none';
                }, 500);
            }, 5000);
        }

        // Animation Functions
        function showAnimation() {
            document.getElementById('welcomeAnimation').style.display = 'flex';
            const logo = document.getElementById('animationLogo');
            logo.classList.remove('animate');
            void logo.offsetWidth;
            logo.classList.add('animate');
        }

        function hideAnimation() {
            document.getElementById('welcomeAnimation').style.display = 'none';
        }

        // Theme Functions
        function setTheme(newTheme) {
            theme = newTheme;
            localStorage.setItem('delhiSimTheme', newTheme);
            document.body.setAttribute('data-theme', newTheme);
        }

        // Load User Data - FIXED VERSION
        async function loadUserData(uid) {
            try {
                const userDocRef = doc(db, "users", uid);
                const userDoc = await getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    userData = userDoc.data();
                    console.log("User data loaded:", userData);
                } else {
                    // Create new user document
                    userData = {
                        uid: uid,
                        email: currentUser.email,
                        name: currentUser.displayName || "",
                        groupId: null,
                        isLeader: false,
                        createdAt: serverTimestamp(),
                        lastActive: serverTimestamp()
                    };
                    await setDoc(userDocRef, userData);
                    console.log("New user created:", userData);
                }
                
                // Update profile display immediately
                updateProfileDisplay();
                
            } catch (error) {
                console.error("Error loading user data:", error);
                showNotification('Error loading profile data', 'error');
            }
        }

        function setupEventListeners() {
            // Login Form
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    showNotification('Login successful!', 'success');
                } catch (error) {
                    showNotification('Login failed: ' + getErrorMessage(error.code), 'error');
                }
            });

            // Signup Form - FIXED VERSION
            document.getElementById('signupForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const name = document.getElementById('signupName').value;
                
                if (password.length < 6) {
                    showNotification('Password must be at least 6 characters', 'error');
                    return;
                }
                
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    
                    // Create user document in Firestore
                    const userRef = doc(db, "users", userCredential.user.uid);
                    await setDoc(userRef, {
                        name: name,
                        email: email,
                        groupId: null,
                        isLeader: false,
                        createdAt: serverTimestamp(),
                        lastActive: serverTimestamp()
                    });
                    
                    showNotification('Account created successfully!', 'success');
                    
                    // Show animation and redirect to dashboard
                    showAnimation();
                    setTimeout(() => {
                        hideAnimation();
                        showDashboard();
                    }, 3000);
                    
                } catch (error) {
                    showNotification('Account creation error: ' + getErrorMessage(error.code), 'error');
                }
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', () => {
                signOut(auth);
                showNotification('Logged out successfully', 'info');
            });

            // Navigation
            document.getElementById('showSignupLink').addEventListener('click', (e) => {
                e.preventDefault();
                showSignup();
            });
            
            document.getElementById('showLoginLink').addEventListener('click', (e) => {
                e.preventDefault();
                showLogin();
            });

            // Dashboard navigation
            document.getElementById('navDashboard').addEventListener('click', (e) => {
                e.preventDefault();
                showDashboard();
            });
            
            document.getElementById('navParties').addEventListener('click', (e) => {
                e.preventDefault();
                showParties();
            });
            
            document.getElementById('navElection').addEventListener('click', (e) => {
                e.preventDefault();
                showElectionCountdown();
            });
            
            document.getElementById('navProfile').addEventListener('click', (e) => {
                e.preventDefault();
                showProfile();
            });
            
            document.getElementById('navSettings').addEventListener('click', (e) => {
                e.preventDefault();
                showSettings();
            });

            // Theme settings
            document.getElementById('themeLight').addEventListener('click', () => setTheme('light'));
            document.getElementById('themeDark').addEventListener('click', () => setTheme('dark'));
            document.getElementById('themeBlue').addEventListener('click', () => setTheme('blue'));
            document.getElementById('themeGreen').addEventListener('click', () => setTheme('green'));

            // Search parties
            document.getElementById('searchParties').addEventListener('input', searchParties);
            
            // Create Party
            document.getElementById('createPartyBtn').addEventListener('click', () => {
                document.getElementById('createPartyModal').style.display = 'flex';
            });

            document.getElementById('closeCreateParty').addEventListener('click', () => {
                document.getElementById('createPartyModal').style.display = 'none';
            });

            document.getElementById('createPartyForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await createNewParty();
            });

            // PM details
            document.getElementById('pmDetailsBtn').addEventListener('click', showPMDetails);
        }

        // Create New Party - FIXED VERSION
        async function createNewParty() {
            const partyName = document.getElementById('newPartyName').value;
            const partyDescription = document.getElementById('newPartyDescription').value;
            const partySymbol = document.getElementById('newPartySymbol').value || "ðŸ›ï¸";
            
            if (!partyName.trim()) {
                showNotification('Please enter a party name', 'error');
                return;
            }
            
            if (userData && userData.groupId) {
                showNotification('You are already in a party!', 'error');
                return;
            }
            
            try {
                // Create party document
                const partyRef = await addDoc(collection(db, "parties"), {
                    name: partyName,
                    description: partyDescription,
                    symbol: partySymbol,
                    leaderId: currentUser.uid,
                    leaderName: userData?.name || currentUser.email,
                    leaderEmail: currentUser.email,
                    memberCount: 1,
                    createdAt: serverTimestamp(),
                    mergeCount: 0,
                    totalVotes: 0,
                    isActive: true
                });
                
                // Update user document
                const userRef = doc(db, "users", currentUser.uid);
                await updateDoc(userRef, {
                    groupId: partyRef.id,
                    isLeader: true,
                    partyName: partyName,
                    joinedPartyAt: serverTimestamp()
                });
                
                // Update local user data
                userData.groupId = partyRef.id;
                userData.isLeader = true;
                userData.partyName = partyName;
                
                showNotification(`Party "${partyName}" created successfully!`, 'success');
                document.getElementById('createPartyModal').style.display = 'none';
                document.getElementById('createPartyForm').reset();
                
                // Reload data
                loadDashboardData();
                loadAllParties();
                updateProfileDisplay();
                
            } catch (error) {
                console.error("Error creating party:", error);
                showNotification('Error creating party: ' + error.message, 'error');
            }
        }

        // Page Navigation
        function showLogin() {
            hideAllPages();
            document.getElementById('loginPage').classList.add('active');
        }

        function showSignup() {
            hideAllPages();
            document.getElementById('signupPage').classList.add('active');
        }

        function showDashboard() {
            hideAllPages();
            document.getElementById('dashboardPage').classList.add('active');
            loadDashboardData();
        }

        function showParties() {
            hideAllPages();
            document.getElementById('partiesPage').classList.add('active');
            loadAllParties();
        }

        function showElectionCountdown() {
            hideAllPages();
            document.getElementById('electionPage').classList.add('active');
        }

        function showProfile() {
            hideAllPages();
            document.getElementById('profilePage').classList.add('active');
            updateProfileDisplay();
        }

        function showSettings() {
            hideAllPages();
            document.getElementById('settingsPage').classList.add('active');
        }

        function showPMDetails() {
            hideAllPages();
            document.getElementById('pmDetailsPage').classList.add('active');
            loadPMDetails();
        }

        function hideAllPages() {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
        }

        // Load Dashboard Data
        async function loadDashboardData() {
            try {
                // Load total parties count
                const partiesSnapshot = await getDocs(collection(db, "parties"));
                document.getElementById('totalPartiesCount').textContent = partiesSnapshot.size;
                
                // Load alone citizens count
                const usersQuery = query(collection(db, "users"), where("groupId", "==", null));
                const aloneUsersSnapshot = await getDocs(usersQuery);
                document.getElementById('aloneCitizensCount').textContent = aloneUsersSnapshot.size;
                
                // Load current PM
                const pmQuery = query(collection(db, "users"), where("isPM", "==", true));
                const pmSnapshot = await getDocs(pmQuery);
                let pmName = "Election in Progress";
                
                if (!pmSnapshot.empty) {
                    const pmData = pmSnapshot.docs[0].data();
                    pmName = pmData.name || pmData.email;
                }
                
                document.getElementById('currentPMName').textContent = pmName;
                
            } catch (error) {
                console.error("Error loading dashboard data:", error);
            }
        }

        // Load All Parties
        async function loadAllParties() {
            const partiesList = document.getElementById('partiesList');
            partiesList.innerHTML = '<div class="loading">Loading parties...</div>';
            
            try {
                const querySnapshot = await getDocs(collection(db, "parties"));
                allPartiesData = [];
                
                querySnapshot.forEach((doc) => {
                    const party = doc.data();
                    party.id = doc.id;
                    allPartiesData.push(party);
                });
                
                displayParties(allPartiesData);
                
            } catch (error) {
                console.error("Error loading parties:", error);
                partiesList.innerHTML = '<div class="error-state">Error loading parties</div>';
            }
        }

        function displayParties(parties) {
            const partiesList = document.getElementById('partiesList');
            partiesList.innerHTML = '';
            
            if (parties.length === 0) {
                partiesList.innerHTML = '<div class="empty-state">No parties found. Be the first to create one!</div>';
                return;
            }
            
            parties.forEach((party) => {
                const div = document.createElement('div');
                div.className = 'party-card';
                div.innerHTML = `
                    <div class="party-header">
                        <div class="party-badge">${party.symbol || party.name.substring(0, 2).toUpperCase()}</div>
                        <div class="party-info">
                            <h4>${party.name}</h4>
                            <p class="party-leader"><i class="fas fa-crown"></i> ${party.leaderName}</p>
                        </div>
                        <span class="member-count">${party.memberCount || 1} Members</span>
                    </div>
                    <p class="party-desc">${party.description || 'No description available'}</p>
                    <div class="party-stats">
                        <span><i class="fas fa-exchange-alt"></i> ${party.mergeCount || 0}/4 Merges</span>
                        <span><i class="fas fa-calendar"></i> ${formatDate(party.createdAt)}</span>
                    </div>
                    <div class="party-actions">
                        ${!userData || !userData.groupId ? `
                            <button class="btn-join" onclick="requestToJoin('${party.id}')">
                                <i class="fas fa-sign-in-alt"></i> Request to Join
                            </button>
                        ` : `
                            <button class="btn-join" disabled>
                                <i class="fas fa-check"></i> Already in a Party
                            </button>
                        `}
                        <button class="btn-view" onclick="viewPartyDetails('${party.id}')">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                    </div>
                `;
                partiesList.appendChild(div);
            });
        }

        // Request to Join Party
        window.requestToJoin = async function(partyId) {
            if (!userData || userData.groupId) {
                showNotification('You are already in a party!', 'error');
                return;
            }
            
            const party = allPartiesData.find(p => p.id === partyId);
            if (!party) {
                showNotification('Party not found', 'error');
                return;
            }
            
            try {
                await addDoc(collection(db, "joinRequests"), {
                    partyId: partyId,
                    partyName: party.name,
                    userId: currentUser.uid,
                    userName: userData.name || currentUser.email,
                    userEmail: currentUser.email,
                    requestedAt: serverTimestamp(),
                    status: 'pending'
                });
                
                showNotification(`Join request sent to ${party.leaderName}!`, 'success');
                
            } catch (error) {
                console.error("Error sending join request:", error);
                showNotification('Error sending request', 'error');
            }
        };

        // View Party Details
        window.viewPartyDetails = function(partyId) {
            const party = allPartiesData.find(p => p.id === partyId);
            if (!party) {
                showNotification('Party not found', 'error');
                return;
            }
            
            showNotification(`Party: ${party.name}<br>Leader: ${party.leaderName}<br>Members: ${party.memberCount}`, 'info');
        };

        // Search Parties
        function searchParties() {
            const searchTerm = document.getElementById('searchParties').value.toLowerCase();
            if (!allPartiesData) return;
            
            if (!searchTerm) {
                displayParties(allPartiesData);
                return;
            }
            
            const filteredParties = allPartiesData.filter(party => 
                party.name.toLowerCase().includes(searchTerm) ||
                (party.description && party.description.toLowerCase().includes(searchTerm)) ||
                party.leaderName.toLowerCase().includes(searchTerm)
            );
            
            displayParties(filteredParties);
        }

        // Election Timer
        function initializeElectionTimer() {
            updateElectionTimer();
            setInterval(updateElectionTimer, 1000);
        }

        function updateElectionTimer() {
            const now = new Date();
            const diff = electionEndDate - now;
            
            if (diff <= 0) {
                electionEndDate = new Date();
                electionEndDate.setDate(electionEndDate.getDate() + 30);
                return;
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('electionDays').textContent = days;
            document.getElementById('electionHours').textContent = hours.toString().padStart(2, '0');
            document.getElementById('electionMinutes').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('electionSeconds').textContent = seconds.toString().padStart(2, '0');
            
            document.getElementById('electionDays2').textContent = days;
            document.getElementById('electionHours2').textContent = hours.toString().padStart(2, '0');
            document.getElementById('electionMinutes2').textContent = minutes.toString().padStart(2, '0');
            document.getElementById('electionSeconds2').textContent = seconds.toString().padStart(2, '0');
        }

        // Load PM Details
        async function loadPMDetails() {
            const pmDetailsContent = document.getElementById('pmDetailsContent');
            pmDetailsContent.innerHTML = '<div class="loading">Loading PM details...</div>';
            
            try {
                const pmQuery = query(collection(db, "users"), where("isPM", "==", true));
                const pmSnapshot = await getDocs(pmQuery);
                
                if (pmSnapshot.empty) {
                    pmDetailsContent.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-crown" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                            <h3>No Prime Minister Elected</h3>
                            <p>Elections are in progress. Check the countdown for next election.</p>
                        </div>
                    `;
                    return;
                }
                
                const pmData = pmSnapshot.docs[0].data();
                pmDetailsContent.innerHTML = `
                    <div class="pm-card">
                        <div class="pm-avatar" style="background: linear-gradient(135deg, var(--primary), var(--secondary));">
                            <i class="fas fa-crown"></i>
                        </div>
                        <h3>${pmData.name || 'Prime Minister'}</h3>
                        <p class="pm-email">${pmData.email}</p>
                        <div class="pm-stats">
                            <div class="pm-stat">
                                <span class="stat-label">Term Started</span>
                                <span class="stat-value">${formatDate(pmData.pmSince) || 'Recently'}</span>
                            </div>
                            <div class="pm-stat">
                                <span class="stat-label">Trust Score</span>
                                <span class="stat-value">${pmData.trustScore || 50}</span>
                            </div>
                            <div class="pm-stat">
                                <span class="stat-label">Party</span>
                                <span class="stat-value">${pmData.partyName || 'Independent'}</span>
                            </div>
                        </div>
                        <div class="pm-policies">
                            <h4>Current Policies</h4>
                            <p>${pmData.policies || 'No active policies announced yet'}</p>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error("Error loading PM details:", error);
                pmDetailsContent.innerHTML = '<div class="error-state">Error loading PM details</div>';
            }
        }

        // Update Profile Display
        function updateProfileDisplay() {
            if (userData) {
                document.getElementById('profileUserName').textContent = userData.name || 'Citizen';
                document.getElementById('profileUserEmail').textContent = userData.email;
                document.getElementById('profilePartyStatus').textContent = userData.groupId ? 'Party Member' : 'Independent';
                
                if (userData.createdAt) {
                    try {
                        const date = userData.createdAt.toDate();
                        document.getElementById('profileJoinDate').textContent = date.toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        });
                    } catch (e) {
                        document.getElementById('profileJoinDate').textContent = 'Recently';
                    }
                } else {
                    document.getElementById('profileJoinDate').textContent = 'Recently';
                }
            }
        }

        // Helper Functions
        function formatDate(timestamp) {
            if (!timestamp) return 'Recent';
            try {
                const date = timestamp.toDate();
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
            } catch (e) {
                return 'Recent';
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
            `;
            document.getElementById('notificationContainer').appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        function getErrorMessage(errorCode) {
            const messages = {
                'auth/invalid-credential': 'Wrong email or password',
                'auth/user-not-found': 'User not found',
                'auth/wrong-password': 'Wrong password',
                'auth/email-already-in-use': 'Email already registered',
                'auth/weak-password': 'Weak password (min 6 characters)',
                'auth/invalid-email': 'Invalid email',
                'auth/network-request-failed': 'Network error'
            };
            return messages[errorCode] || 'An error occurred';
        }

        // Global Variables
        let allPartiesData = [];
    </script>

    <style>
        :root {
            --primary: #1a237e;
            --secondary: #4a148c;
            --accent: #00bcd4;
            --light: #f5f7fa;
            --dark: #1a1a2e;
            --success: #00c853;
            --danger: #d32f2f;
            --warning: #ff9800;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --primary: #0d1b2a;
            --secondary: #415a77;
            --accent: #4cc9f0;
            --light: #1b263b;
            --dark: #0a0a0f;
        }

        [data-theme="blue"] {
            --primary: #1565c0;
            --secondary: #0277bd;
            --accent: #29b6f6;
            --light: #e3f2fd;
            --dark: #0d47a1;
        }

        [data-theme="green"] {
            --primary: #2e7d32;
            --secondary: #388e3c;
            --accent: #66bb6a;
            --light: #e8f5e9;
            --dark: #1b5e20;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--light) 0%, #e0e0e0 100%);
            color: var(--dark);
            min-height: 100vh;
            transition: all 0.3s ease;
            overflow-x: hidden;
        }

        .history-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(26, 35, 126, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(74, 20, 140, 0.1) 0%, transparent 50%),
                linear-gradient(45deg, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
            z-index: -2;
            opacity: 0.3;
        }

        .history-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="%231a237e" opacity="0.1"/></svg>');
            background-size: 100px 100px;
            z-index: -1;
            opacity: 0.2;
        }

        /* India Gate Animation */
        #indiaGateAnimation {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            display: none;
            justify-content: center;
            align-items: flex-end;
            z-index: 9998;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
            pointer-events: none;
        }

        .india-gate-content {
            text-align: center;
            padding-bottom: 100px;
            max-width: 800px;
            margin: 0 auto;
        }

        .india-gate-icon {
            font-size: 6rem;
            color: var(--primary);
            margin-bottom: 1rem;
            text-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Welcome Animation */
        #welcomeAnimation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: fadeOut 3s ease-in-out forwards;
        }

        .animation-content {
            text-align: center;
            color: white;
        }

        #animationLogo {
            font-size: 5rem;
            margin-bottom: 2rem;
            opacity: 0;
            transform: scale(0.5);
            color: white;
        }

        #animationLogo.animate {
            animation: logoAnimation 3s ease-in-out;
        }

        @keyframes logoAnimation {
            0% {
                opacity: 0;
                transform: scale(0.5) rotate(-180deg);
                filter: blur(10px);
            }
            50% {
                opacity: 1;
                transform: scale(1.2) rotate(0deg);
                filter: blur(0);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
                filter: blur(0);
            }
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; visibility: hidden; }
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 1rem 0;
            box-shadow: var(--shadow);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            text-decoration: none;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            box-shadow: 0 4px 15px rgba(26, 35, 126, 0.3);
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text small {
            color: #666;
            font-size: 0.9rem;
        }

        /* Navigation */
        .nav {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .nav-link {
            padding: 0.8rem 1.2rem;
            color: var(--dark);
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            background: linear-gradient(135deg, rgba(26, 35, 126, 0.1), rgba(74, 20, 140, 0.1));
        }

        .nav-link:hover {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-link.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        /* Main Content */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Pages */
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Stats */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.2rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            margin: 0 auto 0.8rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 5px 
