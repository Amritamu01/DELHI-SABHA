<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§∏‡§≠‡§æ - Live App</title>
    
    <!-- Firebase SDK Version 9 (Modular) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, setDoc, serverTimestamp, query, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        
        // üî• YOUR FIREBASE CONFIG (Copy-pasted from Firebase Console)
        const firebaseConfig = {
            apiKey: "AIzaSyCBVXhX11_8___T1NzDPwGPXZxLYl8VuF4",
            authDomain: "politics-fd465.firebaseapp.com",
            projectId: "politics-fd465",
            storageBucket: "politics-fd465.firebasestorage.app",
            messagingSenderId: "506429417906",
            appId: "1:506429417906:web:0196c57945e2d289895cab"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Initialize Realtime Database with your Singapore URL
        const databaseURL = "https://politics-fd465-default-rtdb.asia-southeast1.firebasedatabase.app";
        const rtdb = getDatabase(app, databaseURL);
        
        // Make Firebase available globally
        window.firebase = {
            auth, db, rtdb,
            authFunctions: { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup },
            firestoreFunctions: { collection, addDoc, getDocs, doc, setDoc, serverTimestamp, query, limit },
            rtdbFunctions: { ref, push, onValue, set }
        };
        
        console.log("‚úÖ Firebase initialized successfully!");
    </script>
    
    <style>
        /* ===== MODERN INDIAN THEME ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Noto Sans Devanagari', system-ui;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f1f5f9;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* ===== HEADER ===== */
        .header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            border-radius: 20px;
            margin-bottom: 30px;
            border: 3px solid #f59e0b;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .header h1 {
            font-size: 3rem;
            color: #fbbf24;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .header p {
            font-size: 1.2rem;
            color: #cbd5e1;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        /* ===== AUTH SECTION ===== */
        .auth-section {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            margin: 30px auto;
            border: 2px solid #475569;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        .auth-title {
            text-align: center;
            color: #fbbf24;
            margin-bottom: 30px;
            font-size: 1.8rem;
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #e2e8f0;
            font-weight: 500;
        }
        
        .input-group input {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 2px solid #475569;
            background: #1e293b;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: #0f172a;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.3);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-google {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .btn-logout {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
            color: white;
        }
        
        /* ===== MAIN APP ===== */
        .app-container {
            display: none;
        }
        
        /* User Bar */
        .user-bar {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #475569;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: #0f172a;
        }
        
        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        /* Card Styles */
        .card {
            background: rgba(30, 41, 59, 0.9);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid #475569;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            color: #fbbf24;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #475569;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
        }
        
        /* Chat Section */
        #chatMessages {
            height: 350px;
            overflow-y: auto;
            background: #0f172a;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #475569;
        }
        
        .message {
            background: rgba(59, 130, 246, 0.15);
            padding: 15px;
            margin: 12px 0;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
        }
        
        .message .sender {
            color: #fbbf24;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .message .time {
            font-size: 0.8rem;
            color: #94a3b8;
            float: right;
        }
        
        /* Groups Grid */
        .groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .group-card {
            background: rgba(6, 95, 70, 0.2);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #10b981;
        }
        
        .group-card h3 {
            color: #34d399;
            margin-bottom: 10px;
        }
        
        /* Voting Section */
        .candidates {
            margin-top: 20px;
        }
        
        .candidate {
            background: rgba(124, 58, 237, 0.15);
            padding: 20px;
            margin: 15px 0;
            border-radius: 15px;
            border: 2px solid #8b5cf6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .vote-count {
            background: #1e293b;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            color: #fbbf24;
            font-size: 1.2rem;
        }
        
        /* Stats Footer */
        .stats-footer {
            text-align: center;
            padding: 25px;
            background: rgba(30, 41, 59, 0.9);
            border-radius: 15px;
            margin-top: 40px;
            border: 2px solid #475569;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            color: #fbbf24;
            font-weight: bold;
        }
        
        .stat-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #cbd5e1;
            font-size: 1.1rem;
        }
        
        /* Hindi Font */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;700&display=swap');
        .hindi {
            font-family: 'Noto Sans Devanagari', 'Segoe UI', sans-serif;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .user-bar {
                flex-direction: column;
                gap: 15px;
            }
            
            .stats {
                flex-direction: column;
                gap: 20px;
            }
            
            .btn {
                width: 100%;
                margin: 8px 0;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1 class="hindi">üáÆüá≥ ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§∏‡§≠‡§æ</h1>
            <p class="hindi">‡§≤‡•ã‡§ï‡§§‡§Ç‡§§‡•ç‡§∞ ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§≠‡§µ - ‡§ú‡§®‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§∂‡§ï‡•ç‡§§‡§ø ‡§®‡§ø‡§π‡§ø‡§§ ‡§π‡•à</p>
            <p style="margin-top: 10px; color: #94a3b8; font-size: 0.9rem;">
                Firebase Version ‚Ä¢ Real-time Chat ‚Ä¢ Groups ‚Ä¢ Voting ‚Ä¢ PM Election
            </p>
        </div>
        
        <!-- AUTH SECTION -->
        <div id="authSection" class="auth-section">
            <h2 class="auth-title hindi">‡§≤‡•â‡§ó‡§ø‡§® / ‡§∏‡§æ‡§á‡§® ‡§Ö‡§™</h2>
            
            <div class="input-group">
                <label for="email" class="hindi">‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡§æ</label>
                <input type="email" id="email" placeholder="yourname@example.com" required>
            </div>
            
            <div class="input-group">
                <label for="password" class="hindi">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°</label>
                <input type="password" id="password" placeholder="‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 6 ‡§Ö‡§ï‡•ç‡§∑‡§∞" required>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="window.signup()" class="hindi">
                    üìù ‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§ï‡§∞‡•á‡§Ç
                </button>
                <button class="btn btn-success" onclick="window.login()" class="hindi">
                    üîê ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç
                </button>
                <button class="btn btn-google" onclick="window.loginWithGoogle()" class="hindi">
                    üåê Google ‡§∏‡•á ‡§≤‡•â‡§ó‡§ø‡§®
                </button>
            </div>
            
            <p id="authMessage" style="text-align: center; margin-top: 25px; padding: 15px; border-radius: 10px; background: rgba(239, 68, 68, 0.1); color: #fca5a5; display: none;"></p>
        </div>
        
        <!-- MAIN APP -->
        <div id="appSection" class="app-container">
            <!-- USER BAR -->
            <div class="user-bar">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div>
                        <h3 id="userName" class="hindi">‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ</h3>
                        <p id="userEmail" style="color: #94a3b8; font-size: 0.9rem;">user@example.com</p>
                    </div>
                </div>
                <button class="btn btn-logout" onclick="window.logout()" class="hindi">üö™ ‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button>
            </div>
            
            <!-- DASHBOARD -->
            <div class="dashboard">
                <!-- WORLD CHAT -->
                <div class="card">
                    <h2>üåç <span class="hindi">‡§µ‡§ø‡§∂‡•ç‡§µ ‡§ö‡•à‡§ü</span></h2>
                    <div id="chatMessages">
                        <div class="loading hindi">‡§ö‡•à‡§ü ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à...</div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <input type="text" id="messageInput" class="hindi" 
                               placeholder="‡§Ö‡§™‡§®‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç..." 
                               style="flex: 1; padding: 16px; border-radius: 12px; border: 2px solid #475569; background: #1e293b; color: white; font-size: 1rem;">
                        <button class="btn" onclick="window.sendMessage()" class="hindi">üì§ ‡§≠‡•á‡§ú‡•á‡§Ç</button>
                    </div>
                </div>
                
                <!-- GROUPS -->
                <div class="card">
                    <h2>üë• <span class="hindi">‡§ó‡•ç‡§∞‡•Å‡§™‡•ç‡§∏</span></h2>
                    <div id="groupsList">
                        <div class="loading hindi">‡§ó‡•ç‡§∞‡•Å‡§™‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="window.createGroup()" class="hindi">
                            ‚ûï ‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡•Å‡§™ ‡§¨‡§®‡§æ‡§è‡§Ç
                        </button>
                    </div>
                </div>
                
                <!-- VOTING -->
                <div class="card">
                    <h2>üó≥Ô∏è <span class="hindi">‡§µ‡•ã‡§ü‡§ø‡§Ç‡§ó</span></h2>
                    <p class="hindi" style="margin-bottom: 20px; color: #cbd5e1;">
                        ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§™‡•Ä‡§è‡§Æ ‡§ö‡•Å‡§®‡§æ‡§µ ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à
                    </p>
                    <div id="candidatesList">
                        <div class="loading hindi">‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶‡§µ‡§æ‡§∞ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</div>
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn" onclick="window.addCandidate()" class="hindi">
                            üéØ ‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶‡§µ‡§æ‡§∞ ‡§¨‡§®‡•á‡§Ç
                        </button>
                        <button class="btn btn-secondary" onclick="window.refreshVotes()" class="hindi">
                            üîÑ ‡§µ‡•ã‡§ü ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                        </button>
                    </div>
                </div>
                
                <!-- PM SECTION -->
                <div class="card">
                    <h2>üèõÔ∏è <span class="hindi">‡§™‡•ç‡§∞‡§ß‡§æ‡§®‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä</span></h2>
                    <p class="hindi" id="pmStatus" style="margin-bottom: 20px;">
                        ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§™‡•Ä‡§è‡§Æ: <span id="currentPM" style="color: #fbbf24; font-weight: bold;">‡§®‡§ø‡§∞‡•ç‡§µ‡§æ‡§ö‡§ø‡§§ ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...</span>
                    </p>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <button class="btn" onclick="window.pmAnnouncement()" class="hindi">
                            üì¢ ‡§ò‡•ã‡§∑‡§£‡§æ ‡§ï‡§∞‡•á‡§Ç
                        </button>
                        <button class="btn btn-secondary" onclick="window.startPoll()" class="hindi">
                            üìä ‡§ú‡§®‡§Æ‡§§ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π
                        </button>
                        <button class="btn btn-logout" onclick="window.noConfidenceVote()" class="hindi">
                            ‚öñÔ∏è ‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡§æ‡§µ
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- STATS FOOTER -->
            <div class="stats-footer">
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="activeUsers">0</div>
                        <div class="stat-label hindi">‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalGroups">0</div>
                        <div class="stat-label hindi">‡§ï‡•Å‡§≤ ‡§ó‡•ç‡§∞‡•Å‡§™‡•ç‡§∏</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalVotes">0</div>
                        <div class="stat-label hindi">‡§ï‡•Å‡§≤ ‡§µ‡•ã‡§ü‡•ç‡§∏</div>
                    </div>
                </div>
                <p class="hindi" style="color: #94a3b8; margin-top: 20px;">
                    ¬© 2025 ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§∏‡§≠‡§æ - ‡§≤‡•ã‡§ï‡§§‡§Ç‡§§‡•ç‡§∞ ‡§∏‡§ø‡§Æ‡•Å‡§≤‡•á‡§∂‡§® ‡§™‡•ç‡§≤‡•á‡§ü‡§´‡•â‡§∞‡•ç‡§Æ
                </p>
            </div>
        </div>
    </div>

    <!-- APP LOGIC -->
    <script>
        // ================= GLOBAL FUNCTIONS =================
        
        // Show message
        function showMessage(text, isError = false) {
            const msgEl = document.getElementById('authMessage');
            msgEl.textContent = text;
            msgEl.style.display = 'block';
            msgEl.style.background = isError ? 'rgba(239, 68, 68, 0.1)' : 'rgba(16, 185, 129, 0.1)';
            msgEl.style.color = isError ? '#fca5a5' : '#34d399';
            
            if (!isError) {
                setTimeout(() => {
                    msgEl.style.display = 'none';
                }, 3000);
            }
        }
        
        // ================= AUTHENTICATION =================
        async function signup() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showMessage('‡§ï‡•É‡§™‡§Ø‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§°‡§æ‡§≤‡•á‡§Ç', true);
                return;
            }
            
            if (password.length < 6) {
                showMessage('‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 6 ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§ï‡§æ ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è', true);
                return;
            }
            
            try {
                showMessage('‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...', false);
                
                const { auth, authFunctions } = window.firebase;
                const userCredential = await authFunctions.createUserWithEmailAndPassword(auth, email, password);
                
                // Create user in Firestore
                const { db, firestoreFunctions } = window.firebase;
                await firestoreFunctions.setDoc(firestoreFunctions.doc(db, 'users', userCredential.user.uid), {
                    email: email,
                    name: email.split('@')[0],
                    createdAt: firestoreFunctions.serverTimestamp(),
                    reputation: 100,
                    votes: 0,
                    groups: []
                });
                
                showMessage('‚úÖ ‡§Ö‡§ï‡§æ‡§â‡§Ç‡§ü ‡§¨‡§® ‡§ó‡§Ø‡§æ! ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§≤‡•â‡§ó‡§ø‡§®...', false);
            } catch (error) {
                showMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message, true);
            }
        }
        
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showMessage('‡§ï‡•É‡§™‡§Ø‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§î‡§∞ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§°‡§æ‡§≤‡•á‡§Ç', true);
                return;
            }
            
            try {
                showMessage('‡§≤‡•â‡§ó‡§ø‡§® ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...', false);
                
                const { auth, authFunctions } = window.firebase;
                await authFunctions.signInWithEmailAndPassword(auth, email, password);
                
                showMessage('‚úÖ ‡§≤‡•â‡§ó‡§ø‡§® ‡§∏‡§´‡§≤!', false);
            } catch (error) {
                showMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message, true);
            }
        }
        
        async function loginWithGoogle() {
            try {
                const { auth, authFunctions } = window.firebase;
                const provider = new authFunctions.GoogleAuthProvider();
                await authFunctions.signInWithPopup(auth, provider);
            } catch (error) {
                showMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message, true);
            }
        }
        
        async function logout() {
            try {
                const { auth, authFunctions } = window.firebase;
                await authFunctions.signOut(auth);
            } catch (error) {
                showMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message, true);
            }
        }
        
        // ================= APP FUNCTIONS =================
        function showApp(user) {
            // Update user info
            document.getElementById('userName').textContent = user.email.split('@')[0];
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userAvatar').textContent = user.email[0].toUpperCase();
            
            // Show app, hide auth
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('appSection').style.display = 'block';
            
            // Initialize features
            initChat();
            loadGroups();
            loadCandidates();
            updateStats();
        }
        
        // ================= REAL-TIME CHAT =================
        function initChat() {
            const { rtdb, rtdbFunctions } = window.firebase;
            const chatRef = rtdbFunctions.ref(rtdb, 'worldChat');
            const chatDiv = document.getElementById('chatMessages');
            
            // Load last 50 messages
            rtdbFunctions.onValue(rtdbFunctions.query(chatRef, rtdbFunctions.limitToLast(50)), (snapshot) => {
                chatDiv.innerHTML = '';
                
                if (!snapshot.exists()) {
                    chatDiv.innerHTML = '<div class="message hindi">‡§ö‡•à‡§ü ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç! ‡§™‡§π‡§≤‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≠‡•á‡§ú‡•á‡§Ç‡•§</div>';
                    return;
                }
                
                const messages = [];
                snapshot.forEach((childSnapshot) => {
                    messages.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                // Sort by timestamp
                messages.sort((a, b) => a.timestamp - b.timestamp);
                
                // Display messages
                messages.forEach(msg => {
                    const msgDiv = document.createElement('div');
                    msgDiv.className = 'message';
                    
                    const time = new Date(msg.timestamp).toLocaleTimeString('hi-IN', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    msgDiv.innerHTML = `
                        <div class="sender">${msg.user || '‡§Ö‡§®‡§æ‡§Æ'}</div>
                        <div class="hindi">${msg.text}</div>
                        <div class="time">${time}</div>
                    `;
                    chatDiv.appendChild(msgDiv);
                });
                
                // Scroll to bottom
                chatDiv.scrollTop = chatDiv.scrollHeight;
            });
        }
        
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            const { auth, rtdb, rtdbFunctions } = window.firebase;
            const user = auth.currentUser;
            
            if (!text || !user) return;
            
            try {
                const chatRef = rtdbFunctions.ref(rtdb, 'worldChat');
                await rtdbFunctions.push(chatRef, {
                    user: user.email.split('@')[0],
                    text: text,
                    timestamp: Date.now(),
                    userId: user.uid
                });
                
                input.value = '';
            } catch (error) {
                showMessage('‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≠‡•á‡§ú‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message, true);
            }
        }
        
        // ================= GROUPS SYSTEM =================
        async function loadGroups() {
            const groupsList = document.getElementById('groupsList');
            
            try {
                const { db, firestoreFunctions } = window.firebase;
                const groupsQuery = firestoreFunctions.query(
                    firestoreFunctions.collection(db, 'groups'),
                    firestoreFunctions.limit(10)
                );
                
                const snapshot = await firestoreFunctions.getDocs(groupsQuery);
                
                if (snapshot.empty) {
                    groupsList.innerHTML = `
                        <div class="group-card" style="text-align: center; padding: 30px;">
                            <h3 class="hindi">‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§ó‡•ç‡§∞‡•Å‡§™ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à</h3>
                            <p class="hindi" style="margin: 15px 0; color: #94a3b8;">
                                ‡§™‡§π‡§≤‡§æ ‡§ó‡•ç‡§∞‡•Å‡§™ ‡§¨‡§®‡§æ‡§ï‡§∞ ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§ ‡§ï‡§∞‡•á‡§Ç!
                            </p>
                        </div>
                    `;
                    return;
                }
                
                groupsList.innerHTML = '';
                snapshot.forEach(doc => {
                    const group = doc.data();
                    const groupCard = document.createElement('div');
                    groupCard.className = 'group-card';
                    groupCard.innerHTML = `
                        <h3>${group.name}</h3>
                        <p class="hindi" style="margin: 10px 0; color: #cbd5e1;">
                            ‡§∏‡§¶‡§∏‡•ç‡§Ø: ${group.memberCount || 1}
                        </p>
                        <p class="hindi" style="font-size: 0.9rem; color: #94a3b8;">
                            ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§™‡§ï: ${group.creatorName || group.creator}
                        </p>
                        <button class="btn" style="margin-top: 15px; padding: 10px 20px; font-size: 0.9rem;" 
                                onclick="window.joinGroup('${doc.id}')" class="hindi">
                            ‡§ú‡•ç‡§µ‡§æ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç
                        </button>
                    `;
                    groupsList.appendChild(groupCard);
                });
            } catch (error) {
                groupsList.innerHTML = `<div class="hindi" style="color: #fca5a5;">‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ${error.message}</div>`;
            }
        }
        
        async function createGroup() {
            const groupName = prompt("‡§ó‡•ç‡§∞‡•Å‡§™ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§°‡§æ‡§≤‡•á‡§Ç:");
            if (!groupName) return;
            
            const { auth, db, firestoreFunctions } = window.firebase;
            const user = auth.currentUser;
            
            if (!user) {
                showMessage('‡§™‡§π‡§≤‡•á ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç', true);
                return;
            }
            
            try {
                await firestoreFunctions.addDoc(firestoreFunctions.collection(db, 'groups'), {
                    name: groupName,
                    creator: user.uid,
                    creatorName: user.email.split('@')[0],
                    memberCount: 1,
                    members: [user.uid],
                    createdAt: firestoreFunctions.serverTimestamp(),
                    description: `${groupName} - ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§∏‡§≠‡§æ ‡§ï‡§æ ‡§ó‡•ç‡§∞‡•Å‡§™`
                });
                
                showMessage(`‡§ó‡•ç‡§∞‡•Å‡§™ "${groupName}" ‡§¨‡§® ‡§ó‡§Ø‡§æ!`, false);
                loadGroups();
            } catch (error) {
                showMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message, true);
            }
        }
        
        // ================= VOTING SYSTEM =================
        async function loadCandidates() {
            const candidatesList = document.getElementById('candidatesList');
            
            try {
                const { db, firestoreFunctions } = window.firebase;
                const votesQuery = firestoreFunctions.query(
                    firestoreFunctions.collection(db, 'votes')
                );
                
                const snapshot = await firestoreFunctions.getDocs(votesQuery);
                
                if (snapshot.empty) {
                    candidatesList.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: #94a3b8;" class="hindi">
                            ‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶‡§µ‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§™‡§π‡§≤‡•á ‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶‡§µ‡§æ‡§∞ ‡§¨‡§®‡•á‡§Ç!
                        </div>
                    `;
                    return;
                }
                
                candidatesList.innerHTML = '';
                let candidates = [];
                
                snapshot.forEach(doc => {
                    candidates.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // Sort by votes
                candidates.sort((a, b) => (b.votes || 0) - (a.votes || 0));
                
                // Display candidates
                candidates.forEach(candidate => {
                    const candidateDiv = document.createElement('div');
                    candidateDiv.className = 'candidate';
                    candidateDiv.innerHTML = `
                        <div>
                            <h3 style="color: #fbbf24;">${candidate.name}</h3>
                            <p class="hindi" style="color: #cbd5e1; margin-top: 5px;">
                                ${candidate.description || '‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§∏‡§≠‡§æ ‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶‡§µ‡§æ‡§∞'}
                            </p>
                        </div>
                        <div class="vote-count">${candidate.votes || 0} ‡§µ‡•ã‡§ü‡•ç‡§∏</div>
                    `;
                    candidatesList.appendChild(candidateDiv);
                });
                
                // Update PM status
                if (candidates.length > 0) {
                    document.getElementById('currentPM').textContent = candidates[0].name;
                }
            } catch (error) {
                candidatesList.innerHTML = `<div class="hindi" style="color: #fca5a5;">‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ${error.message}</div>`;
            }
        }
        
        async function addCandidate() {
            const name = prompt("‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§°‡§æ‡§≤‡•á‡§Ç:");
            if (!name) return;
            
            const description = prompt("‡§Ö‡§™‡§®‡§æ ‡§ö‡•Å‡§®‡§æ‡§µ ‡§µ‡§æ‡§¶‡§æ/‡§µ‡§ø‡§ö‡§æ‡§∞ (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï):");
            
            const { auth, db, firestoreFunctions } = window.firebase;
            const user = auth.currentUser;
            
            if (!user) {
                showMessage('‡§™‡§π‡§≤‡•á ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç', true);
                return;
            }
            
            try {
                await firestoreFunctions.addDoc(firestoreFunctions.collection(db, 'votes'), {
                    name: name,
                    description: description || `${name} - ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§∏‡§≠‡§æ ‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶‡§µ‡§æ‡§∞`,
                    votes: 1,
                    votedBy: [user.uid],
                    userId: user.uid,
                    createdAt: firestoreFunctions.serverTimestamp()
                });
                
                showMessage(`‡§â‡§Æ‡•ç‡§Æ‡•Ä‡§¶‡§µ‡§æ‡§∞ "${name}" ‡§¨‡§® ‡§ó‡§è!`, false);
                loadCandidates();
            } catch (error) {
                showMessage('‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ' + error.message, true);
            }
        }
        
        // ================= STATISTICS =================
        async function updateStats() {
            try {
                const { db, firestoreFunctions } = window.firebase;
                
                // Active users (last 24 hours - simulated)
                document.getElementById('activeUsers').textContent = Math.floor(Math.random() * 50) + 10;
                
                // Total groups
                const groupsSnapshot = await firestoreFunctions.getDocs(firestoreFunctions.collection(db, 'groups'));
                document.getElementById('totalGroups').textContent = groupsSnapshot.size;
                
                // Total votes
                const votesSnapshot = await firestoreFunctions.getDocs(firestoreFunctions.collection(db, 'votes'));
                let totalVotes = 0;
                votesSnapshot.forEach(doc => {
                    totalVotes += (doc.data().votes || 0);
                });
                document.getElementById('totalVotes').textContent = totalVotes;
            } catch (error) {
                console.error("Stats error:", error);
            }
        }
        
        // ================= HELPER FUNCTIONS =================
        async function refreshVotes() {
            loadCandidates();
            updateStats();
            showMessage('‡§µ‡•ã‡§ü ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§è ‡§ó‡§è!', false);
        }
        
        function pmAnnouncement() {
            const announcement = prompt("‡§Ö‡§™‡§®‡•Ä ‡§ò‡•ã‡§∑‡§£‡§æ ‡§°‡§æ‡§≤‡•á‡§Ç:");
            if (announcement) {
                showMessage(`‡§ò‡•ã‡§∑‡§£‡§æ ‡§≠‡•á‡§ú‡•Ä ‡§ó‡§à: "${announcement}"`, false);
                
                // Add to chat
                const { auth } = window.firebase;
                const user = auth.currentUser;
                if (user) {
                    sendPMAnnouncement(announcement, user);
                }
            }
        }
        
        async function sendPMAnnouncement(announcement, user) {
            const { rtdb, rtdbFunctions } = window.firebase;
            const chatRef = rtdbFunctions.ref(rtdb, 'worldChat');
            
            await rtdbFunctions.push(chatRef, {
                user: "üì¢ PM Announcement",
                text: `[PM] ${announcement}`,
                timestamp: Date.now(),
                isAnnouncement: true
            });
        }
        
        function startPoll() {
            const question = prompt("‡§ú‡§®‡§Æ‡§§ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π ‡§ï‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§°‡§æ‡§≤‡•á‡§Ç:");
            if (question) {
                showMessage(`‡§ú‡§®‡§Æ‡§§ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π ‡§∂‡•Å‡§∞‡•Ç: "${question}"`, false);
            }
        }
        
        function noConfidenceVote() {
            const confirm = window.confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à ‡§™‡•ç‡§∞‡§ß‡§æ‡§®‡§Æ‡§Ç‡§§‡•ç‡§∞‡•Ä ‡§ï‡•á ‡§ñ‡§ø‡§≤‡§æ‡§´ ‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡§æ‡§µ ‡§≤‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?");
            if (confirm) {
                showMessage('‡§Ö‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§™‡•ç‡§∞‡§∏‡•ç‡§§‡§æ‡§µ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ! ‡§Æ‡§§‡§¶‡§æ‡§® ‡§ú‡§≤‡•ç‡§¶ ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§ó‡§æ‡•§', false);
            }
        }
        
        async function joinGroup(groupId) {
            showMessage('‡§ó‡•ç‡§∞‡•Å‡§™ ‡§Æ‡•á‡§Ç ‡§ú‡•ç‡§µ‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...', false);
            // Implementation for joining groups
            setTimeout(() => {
                showMessage('‡§ó‡•ç‡§∞‡•Å‡§™ ‡§Æ‡•á‡§Ç ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ç‡§µ‡§æ‡§á‡§® ‡§ï‡§ø‡§Ø‡§æ!', false);
            }, 1000);
        }
        
        // ================= INITIALIZATION =================
        // Auth state listener
        const { auth, authFunctions } = window.firebase;
        authFunctions.onAuthStateChanged(auth, (user) => {
            if (user) {
                showApp(user);
            } else {
                document.getElementById('appSection').style.display = 'none';
                document.getElementById('authSection').style.display = 'block';
                document.getElementById('authMessage').style.display = 'none';
            }
        });
        
        // Enter key for chat
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Make functions globally available
        window.signup = signup;
        window.login = login;
        window.loginWithGoogle = loginWithGoogle;
        window.logout = logout;
        window.sendMessage = sendMessage;
        window.createGroup = createGroup;
        window.addCandidate = addCandidate;
        window.refreshVotes = refreshVotes;
        window.pmAnnouncement = pmAnnouncement;
        window.startPoll = startPoll;
        window.noConfidenceVote = noConfidenceVote;
        window.joinGroup = joinGroup;
        
        console.log("üöÄ Delhi Sabha App Loaded Successfully!");
    </script>
</body>
</html>
